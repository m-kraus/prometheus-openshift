


# Firewall 9100 (all nodes)
# https://github.com/wkulhanek/openshift-prometheus/tree/master/node-exporter


oc login -u system:admin
oc new-project monitoring
# oc export limits default-limits -o yaml > default_limits.yaml
oc delete limitrange default-limits
# oc export quota default-quota -o yaml > deault_quota.yaml
oc delete quota default-quota
oc create serviceaccount prometheus
oc create serviceaccount kube-state-metrics
oc create serviceaccount grafana
oc create serviceaccount node-exporter

# optional: 
oc adm policy add-cluster-role-to-user cluster-admin admin

oc adm policy add-scc-to-user anyuid -z prometheus
oc adm policy add-scc-to-user anyuid -z grafana
oc adm policy add-scc-to-user privileged -z node-exporter

oc adm policy add-cluster-role-to-user cluster-reader system:serviceaccount:monitoring:prometheus
oc adm policy add-cluster-role-to-user cluster-reader system:serviceaccount:monitoring:kube-state-metrics


oc apply -f obj/01-prometheus.yaml

oc apply -f obj/02-grafana.yaml

oc annotate ns monitoring openshift.io/node-selector= --overwrite
oc apply -f obj/03-node-exporter.yaml

oc apply -f obj/04-kube-state-metrics.yaml

#------
TODO:

#------
NOTES: 
oc get events --sort-by='.lastTimestamp'
oc get ds --all-namespaces
oc get pods -o wide

#-----
FRAGEN: 
- Warum muss eine dc vor dem redeploy geloescht werden
